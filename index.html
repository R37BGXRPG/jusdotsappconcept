<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JusDots - Unified Chat</title>
    
    <link rel="stylesheet" href="deepOcean.css">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <style>
        /* Hide the body initially to prevent the "Flash" of content for unauthenticated users */
        body { 
            display: none; 
            margin: 0;
            font-family: 'Poppins', sans-serif;
        }
        
        .user-profile-mini {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: var(--item-bg);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .user-profile-mini img {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 2px solid var(--accent);
        }

        .logout-btn {
            background: transparent;
            color: #ff5f5f;
            border: 1px solid #ff5f5f;
            padding: 5px 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
        }
    </style>
</head>
<body class="theme-deep-ocean">

    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>JusDots</h2>
            </div>
            
            <div class="user-profile-mini">
                <img id="user-pic" src="https://via.placeholder.com/35" alt="Profile">
                <div>
                    <div id="user-name" style="font-size: 14px; font-weight: bold;">Loading...</div>
                    <button class="logout-btn" onclick="logout()">Sign Out</button>
                </div>
            </div>

            <nav class="nav-menu">
                <a href="#" class="active">All Chats</a>
                <a href="settings.html">Settings</a>
            </nav>
        </aside>

        <main class="chat-list">
            <div class="search-bar">
                <input type="text" placeholder="Search messages...">
            </div>
            <div class="conversations">
                <div class="chat-item active">
                    <div class="avatar">W</div>
                    <div class="details">
                        <h4>WhatsApp Group</h4>
                        <p>Hey, did you see the update?</p>
                    </div>
                </div>
            </div>
        </main>

        <section class="message-view">
            <header class="chat-header">
                <h3>WhatsApp Group</h3>
            </header>
            <div class="chat-window">
                <div class="message received">How is the app coming along?</div>
                <div class="message sent">Just added the Auth Gateway!</div>
            </div>
            <div class="input-area">
                <input type="text" placeholder="Type a message...">
                <button class="send-btn">Send</button>
            </div>
        </section>
    </div>

    <script>
        // 1. YOUR FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyApxpA5L31Tl3amG1vSPbKFUW0WJedK8XY",
            authDomain: "jusdots-aggregator.firebaseapp.com",
            projectId: "jusdots-aggregator",
            storageBucket: "jusdots-aggregator.firebasestorage.app",
            messagingSenderId: "814287216066",
            appId: "1:814287216066:web:7975cec7e030f1b1204a5b"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        // 2. THE GATEKEEPER
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                // User is logged in
                console.log("Access Granted:", user.uid);
                
                // Show the body
                document.body.style.display = "block";
                
                // Update Profile UI
                document.getElementById('user-name').innerText = user.displayName || user.phoneNumber || "User";
                if (user.photoURL) {
                    document.getElementById('user-pic').src = user.photoURL;
                }
            } else {
                // No user found, redirect to your auth.html
                window.location.href = 'auth.html';
            }
        });

        // 3. LOGOUT FUNCTION
        function logout() {
            firebase.auth().signOut().then(() => {
                window.location.href = 'auth.html';
            });
        }
    </script>
</body>
</html>
